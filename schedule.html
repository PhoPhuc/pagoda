<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh T·∫°o L·ªãch Tr√¨nh Du L·ªãch AI - Ch√πa T√¢n H·ªìng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .step { display: none; }
        .step.active { display: block; }
        .progress-bar-fill { transition: width 0.5s ease-in-out; }
        
        /* Custom Checkbox/Radio for Soft Design */
        .custom-choice input { display: none; }
        .custom-choice label {
            cursor: pointer;
            display: block;
            text-align: center;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb; /* border-gray-200 */
            background: #f9fafb; /* bg-gray-50 */
            color: #374151; /* text-gray-700 */
            transition: all 0.2s ease-in-out;
        }
        .custom-choice input:checked + label {
            background: #4f46e5; /* bg-indigo-600 */
            color: white;
            border-color: #4f46e5; /* border-indigo-600 */
            font-weight: 600;
        }
        .custom-choice label:hover {
            border-color: #a5b4fc; /* border-indigo-300 */
        }

        .loader {
            border: 4px solid #e5e7eb; /* border-gray-200 */
            border-radius: 50%;
            border-top: 4px solid #4f46e5; /* border-indigo-600 */
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Timeline styles for Soft Design */
        .timeline {
            position: relative;
            padding-left: 3rem;
            margin: 1rem 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 1.5rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb; /* bg-gray-200 */
            transform: translateX(-50%);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-icon {
            position: absolute;
            left: -1.5rem;
            top: 0;
            transform: translateX(-50%);
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4f46e5; /* bg-indigo-600 */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl mx-auto">
        <div id="app-container" class="bg-white text-gray-800 p-6 md:p-10 rounded-2xl shadow-xl">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold mb-2 text-gray-900">T·∫°o L·ªãch Tr√¨nh Du L·ªãch T√¢n H·ªìng</h1>
                <p class="text-gray-500">C√πng A.I l√™n k·∫ø ho·∫°ch cho chuy·∫øn ƒëi ho√†n h·∫£o c·ªßa b·∫°n!</p>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-8">
                <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full progress-bar-fill" style="width: 20%"></div>
            </div>

            <!-- Steps Container -->
            <div id="steps-container">
                 <!-- Step 1: Select Temples -->
                <div id="step-1" class="step active">
                    <h2 class="text-2xl font-semibold mb-6 text-center">B∆∞·ªõc 1: B·∫°n mu·ªën vi·∫øng ch√πa n√†o?</h2>
                    <div class="grid grid-cols-2 gap-4 custom-choice">
                        <div><input type="checkbox" id="don-hau" value="Ch√πa ƒê√¥n H·∫≠u" class="temple-checkbox"><label for="don-hau">Ch√πa ƒê√¥n H·∫≠u</label></div>
                        <div><input type="checkbox" id="dong-an" value="Ch√πa ƒê√¥ng An" class="temple-checkbox"><label for="dong-an">Ch√πa ƒê√¥ng An</label></div>
                        <div><input type="checkbox" id="phuoc-thien" value="Ch√πa Ph∆∞·ªõc Thi·ªán" class="temple-checkbox"><label for="phuoc-thien">Ch√πa Ph∆∞·ªõc Thi·ªán</label></div>
                        <div><input type="checkbox" id="hieu-duc" value="Ch√πa Hi·∫øu ƒê·ª©c" class="temple-checkbox"><label for="hieu-duc">Ch√πa Hi·∫øu ƒê·ª©c</label></div>
                    </div>
                    <div class="mt-8 flex justify-end">
                        <button onclick="nextStep(2)" class="rounded-xl transition duration-300 transform hover:scale-105 bg-indigo-600 text-white font-semibold py-3 px-8 shadow-lg hover:shadow-indigo-400/50">Ti·∫øp t·ª•c</button>
                    </div>
                </div>
                <!-- Step 2: Select Time Frame -->
                <div id="step-2" class="step">
                    <h2 class="text-2xl font-semibold mb-6 text-center">B∆∞·ªõc 2: Ch·ªçn khung th·ªùi gian ƒëi</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="start-time" class="font-medium text-gray-700">Th·ªùi gian b·∫Øt ƒë·∫ßu</label>
                            <select id="start-time" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="end-time" class="font-medium text-gray-700">Th·ªùi gian k·∫øt th√∫c</label>
                            <select id="end-time" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button onclick="prevStep(1)" class="rounded-xl transition duration-300 hover:bg-gray-300 bg-gray-200 text-gray-700 font-semibold py-3 px-8">Quay l·∫°i</button>
                        <button onclick="nextStep(3)" class="rounded-xl transition duration-300 transform hover:scale-105 bg-indigo-600 text-white font-semibold py-3 px-8 shadow-lg hover:shadow-indigo-400/50">Ti·∫øp t·ª•c</button>
                    </div>
                </div>
                 <!-- Step 3: Group Details -->
                <div id="step-3" class="step">
                    <h2 class="text-2xl font-semibold mb-6 text-center">B∆∞·ªõc 3: ƒê·∫∑c ƒëi·ªÉm nh√≥m c·ªßa b·∫°n l√† g√¨?</h2>
                    <div class="custom-choice">
                         <div class="grid grid-cols-2 gap-4">
                            <div><input type="radio" id="audience-friends" name="audience" value="Nh√≥m b·∫°n tr·∫ª" checked><label for="audience-friends">B·∫°n b√®</label></div>
                            <div><input type="radio" id="audience-family" name="audience" value="Gia ƒë√¨nh c√≥ tr·∫ª em"><label for="audience-family">Gia ƒë√¨nh</label></div>
                            <div><input type="radio" id="audience-elderly" name="audience" value="Nh√≥m c√≥ ng∆∞·ªùi l·ªõn tu·ªïi"><label for="audience-elderly">C√≥ ng∆∞·ªùi l·ªõn tu·ªïi</label></div>
                            <div><input type="radio" id="audience-solo" name="audience" value="ƒêi m·ªôt m√¨nh"><label for="audience-solo">M·ªôt m√¨nh</label></div>
                         </div>
                    </div>
                     <div class="mt-8 flex justify-between">
                        <button onclick="prevStep(2)" class="rounded-xl transition duration-300 hover:bg-gray-300 bg-gray-200 text-gray-700 font-semibold py-3 px-8">Quay l·∫°i</button>
                        <button onclick="nextStep(4)" class="rounded-xl transition duration-300 transform hover:scale-105 bg-indigo-600 text-white font-semibold py-3 px-8 shadow-lg hover:shadow-indigo-400/50">Ti·∫øp t·ª•c</button>
                    </div>
                </div>
                <!-- Step 4: Select Preferences -->
                <div id="step-4" class="step">
                    <h2 class="text-2xl font-semibold mb-6 text-center">B∆∞·ªõc 4: Y√™u c·∫ßu th√™m c·ªßa b·∫°n?</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 custom-choice">
                        <div><input type="checkbox" id="pref-food" class="preference-checkbox"><label for="pref-food">ƒÇn u·ªëng</label></div>
                        <div><input type="checkbox" id="pref-drink" class="preference-checkbox"><label for="pref-drink">Gi·∫£i kh√°t</label></div>
                        <div><input type="checkbox" id="pref-stay" class="preference-checkbox"><label for="pref-stay">Ngh·ªâ l·∫°i</label></div>
                    </div>
                    <div class="mt-8 flex justify-between">
                        <button onclick="prevStep(3)" class="rounded-xl transition duration-300 hover:bg-gray-300 bg-gray-200 text-gray-700 font-semibold py-3 px-8">Quay l·∫°i</button>
                        <button onclick="generateItinerary()" class="rounded-xl transition duration-300 transform hover:scale-105 bg-indigo-600 text-white font-semibold py-3 px-8 shadow-lg hover:shadow-indigo-400/50">T·∫°o L·ªãch Tr√¨nh</button>
                    </div>
                </div>

                <!-- Step 5: Result -->
                <div id="step-5" class="step">
                    <h2 class="text-2xl font-semibold mb-6 text-center">L·ªãch tr√¨nh g·ª£i √Ω</h2>
                    <div id="loading" class="flex justify-center items-center my-8 hidden">
                       <div class="loader"></div>
                    </div>
                    <div id="itinerary-output" class="bg-gray-50 p-6 rounded-lg min-h-[200px] border border-gray-200">
                        <div id="itinerary-result"></div>
                    </div>
                    <div class="mt-8 flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="captureSchedule()" class="rounded-xl transition duration-300 hover:bg-gray-300 bg-gray-200 text-gray-800 font-semibold py-3 px-8 flex items-center justify-center gap-2">
                            <i data-lucide="camera"></i> Ch·ª•p ·∫£nh L·ªãch tr√¨nh
                        </button>
                        <button onclick="startOver()" class="rounded-xl transition duration-300 transform hover:scale-105 bg-indigo-600 text-white font-semibold py-3 px-8 shadow-lg hover:shadow-indigo-400/50">T·∫°o l·ªãch tr√¨nh m·ªõi</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    let currentStep = 1;
    const totalSteps = 5;

    function updateProgressBar() {
        const progressBar = document.getElementById('progress-bar');
        const progress = (currentStep / totalSteps) * 100;
        progressBar.style.width = `${progress}%`;
    }

    function showStep(stepNumber) {
        document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
        document.getElementById(`step-${stepNumber}`).classList.add('active');
        currentStep = stepNumber;
        updateProgressBar();
        lucide.createIcons(); // Re-render icons on step change
    }

    function nextStep(stepNumber) {
        if (currentStep === 1 && document.querySelectorAll('.temple-checkbox:checked').length === 0) {
            alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ng√¥i ch√πa.');
            return;
        }
        if (currentStep === 2) {
            const startTime = parseInt(document.getElementById('start-time').value);
            const endTime = parseInt(document.getElementById('end-time').value);
            if (startTime >= endTime) {
                alert('Th·ªùi gian k·∫øt th√∫c ph·∫£i sau th·ªùi gian b·∫Øt ƒë·∫ßu.');
                return;
            }
        }
        showStep(stepNumber);
    }
    
    function prevStep(stepNumber) { showStep(stepNumber); }

    function startOver() {
        // Reset all inputs to default state
        document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
        document.getElementById('start-time').value = '7';
        document.getElementById('end-time').value = '17';
        document.getElementById('audience-friends').checked = true;
        
        document.getElementById('itinerary-result').innerHTML = '';
        showStep(1);
    }
    
    function getIconForActivity(activity) {
        const lowerActivity = activity.toLowerCase();
        if (lowerActivity.includes('ch√πa') || lowerActivity.includes('vi·∫øng')) return 'church';
        if (lowerActivity.includes('ƒÉn') || lowerActivity.includes('d√πng b·ªØa')) return 'utensils-crossed';
        if (lowerActivity.includes('c√† ph√™') || lowerActivity.includes('gi·∫£i kh√°t') || lowerActivity.includes('n∆∞·ªõc')) return 'coffee';
        if (lowerActivity.includes('nh·∫≠n ph√≤ng') || lowerActivity.includes('ngh·ªâ')) return 'bed-double';
        if (lowerActivity.includes('kh·ªüi h√†nh') || lowerActivity.includes('di chuy·ªÉn')) return 'car';
        if (lowerActivity.includes('k·∫øt th√∫c')) return 'flag';
        return 'map-pin';
    }

    function parseAndRenderItinerary(text) {
        const resultDiv = document.getElementById('itinerary-result');
        resultDiv.innerHTML = ''; // Clear previous results
        const timeline = document.createElement('div');
        timeline.className = 'timeline';

        const lines = text.split('\n').filter(line => line.trim() !== '');
        lines.forEach(line => {
            const parts = line.split(' - ');
            if (parts.length < 2) return;
            const timeAndEmojiPart = parts[0];
            const restOfString = parts.slice(1).join(' - ').trim();
            const timeMatch = timeAndEmojiPart.match(/(\*\*.*?\*\*|`.*?`)/);
            if (!timeMatch) return;
            const timeRaw = timeMatch[0];
            const time = timeRaw.replace(/[\*`]/g, '');
            const emoji = timeAndEmojiPart.replace(timeRaw, '').trim();
            
            let activity = restOfString;
            let locationName = null;
            let locationAddress = null;

            const fullLocationMatch = restOfString.match(/(.*?)\s+t·∫°i\s+\[\[(.*?)\s*-\s*(.*?)\]\]\.?$/);
            const simpleLocationMatch = restOfString.match(/(.*?)\s+t·∫°i\s+\[\[(.*?)\]\]\.?$/);

            if (fullLocationMatch) {
                activity = fullLocationMatch[1].trim();
                locationName = fullLocationMatch[2].trim();
                locationAddress = fullLocationMatch[3].trim();
            } else if (simpleLocationMatch) {
                activity = simpleLocationMatch[1].trim();
                locationName = simpleLocationMatch[2].trim();
            } else {
                if (activity.endsWith('.')) {
                    activity = activity.slice(0, -1);
                }
            }
            if (!activity) return;

            // Apply formatting for italics and underline
            activity = activity
                .replace(/\*(.*?)\*/g, '<i>$1</i>')
                .replace(/\_(.*?)\_/g, '<u>$1</u>');

            const iconName = getIconForActivity(activity);
            const item = document.createElement('div');
            item.className = 'timeline-item';
            
            let locationHtml = '';
            if (locationName) {
                const mapQuery = locationAddress ? `${locationName}, ${locationAddress}` : `${locationName}, T√¢n H·ªìng, ƒê·ªìng Th√°p`;
                const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(mapQuery)}`;
                const addressHtml = locationAddress ? `<span class="text-xs text-gray-500 block">${locationAddress}</span>` : '';
                
                locationHtml = `
                    <a href="${mapUrl}" target="_blank" class="block group mt-2">
                        <div class="flex items-start gap-2">
                             <i data-lucide="map-pin" class="w-4 h-4 flex-shrink-0 mt-1 text-gray-400 group-hover:text-indigo-600"></i>
                             <div>
                                <span class="font-medium text-indigo-600 group-hover:underline">${locationName}</span>
                                ${addressHtml}
                             </div>
                        </div>
                    </a>`;
            }
            
            item.innerHTML = `
                <div class="timeline-icon"><i data-lucide="${iconName}"></i></div>
                <div class="timeline-content">
                    <p class="font-semibold text-indigo-600">${time}</p>
                    <p class="font-bold text-lg text-gray-800">${emoji} ${activity}</p>
                    ${locationHtml}
                </div>`;
            timeline.appendChild(item);
        });

        resultDiv.appendChild(timeline);
        lucide.createIcons();
    }
    
    function captureSchedule() {
        const scheduleElement = document.getElementById('itinerary-output');
        if (!scheduleElement || scheduleElement.innerText.trim() === '') {
            alert('Kh√¥ng c√≥ l·ªãch tr√¨nh ƒë·ªÉ ch·ª•p ·∫£nh.');
            return;
        }
        html2canvas(scheduleElement, { 
            backgroundColor: '#f9fafb',
            scale: 2 
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'lich-trinh-du-lich-tan-hong.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    async function generateItinerary() {
        showStep(5);
        const loadingDiv = document.getElementById('loading');
        const resultDiv = document.getElementById('itinerary-result');
        loadingDiv.classList.remove('hidden');
        resultDiv.innerHTML = '';

        const selectedTemples = Array.from(document.querySelectorAll('.temple-checkbox:checked')).map(cb => cb.value);
        const startTime = document.getElementById('start-time').value + ':00';
        const endTime = document.getElementById('end-time').value + ':00';
        const audience = document.querySelector('input[name="audience"]:checked').value;
        const includeFood = document.getElementById('pref-food').checked;
        const includeDrink = document.getElementById('pref-drink').checked;
        const includeStay = document.getElementById('pref-stay').checked;

        let prompt = `B·∫°n l√† m·ªôt tr·ª£ l√Ω du l·ªãch chuy√™n nghi·ªáp t·∫°i huy·ªán T√¢n H·ªìng, ƒê·ªìng Th√°p. H√£y t·∫°o m·ªôt l·ªãch tr√¨nh du l·ªãch ng·∫Øn g·ªçn, h·ª£p l√Ω v√† d·ªÖ hi·ªÉu theo c√°c y√™u c·∫ßu sau:\n\n`;
        
        prompt += `D·ªÆ LI·ªÜU B·∫ÆT BU·ªòC S·ª¨ D·ª§NG:\n`;
        prompt += `- ƒêi·ªÉm xu·∫•t ph√°t M·∫∂C ƒê·ªäNH: Trung t√¢m th·ªã tr·∫•n Sa R√†i, T√¢n H·ªìng, ƒê·ªìng Th√°p.\n`;
        prompt += `- D·ªØ li·ªáu ƒë·ªãa ch·ªâ ch√πa CH√çNH X√ÅC (s·ª≠ d·ª•ng ƒë√∫ng ƒë·ªãa ch·ªâ n√†y):\n`;
        prompt += `  - Ch√πa ƒê√¥n H·∫≠u: B√¨nh Ph√∫, T√¢n H·ªìng, ƒê·ªìng Th√°p\n`;
        prompt += `  - Ch√πa Ph∆∞·ªõc Thi·ªán: C√¥ng T·∫°o, B√¨nh Ph√∫, T√¢n H·ªìng, ƒê·ªìng Th√°p\n`;
        prompt += `  - Ch√πa ƒê√¥ng An: T√¢n H·ªô C∆°, T√¢n H·ªìng, ƒê·ªìng Th√°p\n`;
        prompt += `  - Ch√πa Hi·∫øu ƒê·ª©c: T√¢n H·ªô C∆°, T√¢n H·ªìng, ƒê·ªìng Th√°p\n`;
        prompt += `- DANH S√ÅCH QU√ÅN ƒÇN/C√Ä PH√ä (∆ØU TI√äN CH·ªåN T·ª™ ƒê√ÇY):\n`;
        prompt += `  - C∆°m t√¢m ƒë√™m B·∫£o Xuy√™n: Nguy·ªÖn Hu·ªá, TT. Sa R√†i, H. T√¢n H·ªìng, ƒê·ªìng Th√°p\n`;
        prompt += `  - Ph·ªü T√°m H∆°n: TT. Sa R√†i, T√¢n H·ªìng, ƒê·ªìng Th√°p\n`;
        prompt += `  - M√¨ Qu·∫£ng Gi√°o L∆∞·ª£ng: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - B√∫n ri√™u Cua ƒê·ªìng: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - H·ªß ti·∫øu Nam Vang Hu·ª≥nh K√Ω: QL30, TT. Sa R√†i\n`;
        prompt += `  - B√∫n b√≤ Hu·∫ø O C√∫c: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n ƒÉn gia ƒë√¨nh T∆∞ L√πn 2: QL30, An Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - B√°nh x√®o mi·ªÅn T√¢y: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Ch√°o l√≤ng √îng M·∫≠p: Ch·ª£ Sa R√†i, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n c∆°m chay Thi·ªán Duy√™n: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n ch√°o c√° l√≥c rau ƒë·∫Øng: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - L·∫©u m·∫Øm mi·ªÅn T√¢y: QL30, T√¢n Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - B√≤ n√© 3 Ngon: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - G√† n∆∞·ªõng lu B·∫£y ƒê·ª±c: QL30, An Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - V·ªãt quay A L√Ω: Ch·ª£ Sa R√†i, TT. Sa R√†i\n`;
        prompt += `  - B√∫n c√° Ch√¢u ƒê·ªëc: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Nem n∆∞·ªõng Nha Trang: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n ·ªëc ƒë√™m: Ch·ª£ Sa R√†i, TT. Sa R√†i\n`;
        prompt += `  - B√°nh canh gh·∫π: QL30, TT. Sa R√†i\n`;
        prompt += `  - C∆°m t·∫•m S∆∞·ªùn B√¨ Ch·∫£: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - L·∫©u Th√°i Tom Yum: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n d√™ n√∫i 79: QL30, An Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - B√°nh m√¨ ch·∫£o: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - B√≤ t∆° C·ªß Chi: QL30, T√¢n Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - C∆°m g√† x·ªëi m·ª°: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Apaoma Coffee: Nguy·ªÖn Hu·ªá, TT. Sa R√†i, H. T√¢n H·ªìng\n`;
        prompt += `  - Hoa S·ª© Cafe: QL30, TT. Sa R√†i\n`;
        prompt += `  - The Coffee House T√¢n H·ªìng: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - Milano Coffee: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Cafe B·ªù K√®: B·ªù k√® s√¥ng Sa R√†i, TT. Sa R√†i\n`;
        prompt += `  - Cafe S√¢n V∆∞·ªùn √öt T·ªãch: QL30, An Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - Tr√† s·ªØa BoBaPoP: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - Cafe Ph·ªë: ƒê∆∞·ªùng T·ªânh 843, TT. Sa R√†i\n`;
        prompt += `  - Cafe 1985: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - Cafe Acoustic Garden: QL30, T√¢n Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - Tr√† chanh B·ª•i Ph·ªë: B·ªù k√® s√¥ng Sa R√†i, TT. Sa R√†i\n`;
        prompt += `  - Cafe Sala: Nguy·ªÖn Hu·ªá, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n C√† Ph√™ Su·ªëi Ngu·ªìn: DH. T√¢n Th√†nh, Th√¥ng B√¨nh, T√¢n H·ªìng\n`;
        prompt += `  - Cafe ƒêi·ªÉm H·∫πn: X√£ An Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - Qu√°n N∆∞·ªõc M√≠a V∆∞·ªùn Cau: QL30, TT. Sa R√†i\n`;
        prompt += `  - Qu√°n Caf√© H·ªØu T√¢m: DH. T√¢n Th√†nh, Th√¥ng B√¨nh, T√¢n H·ªìng\n`;
        prompt += `  - Tr√† S·ªØa Boon Tea: X√£ T√¢n H·ªô C∆°, T√¢n H·ªìng\n`;
        prompt += `  - Qu√°n c√† ph√™ T√¢n K·ª∑: X√£ An Ph∆∞·ªõc, T√¢n H·ªìng\n`;
        prompt += `  - Qu√°n c√† ph√™ B√≤n Bon: X√£ T√¢n H·ªô C∆°, T√¢n H·ªìng\n\n`;

        prompt += `Y√äU C·∫¶U T·ª™ NG∆Ø·ªúI D√ôNG:\n`;
        prompt += `- C√°c ch√πa mu·ªën ƒëi: ${selectedTemples.join(', ')}.\n`;
        prompt += `- Khung th·ªùi gian: t·ª´ ${startTime} ƒë·∫øn ${endTime}. L∆ØU √ù: ${startTime} l√† th·ªùi gian KH·ªûI H√ÄNH t·ª´ Sa R√†i.\n`;
        prompt += `- ƒê·∫∑c ƒëi·ªÉm nh√≥m: ${audience}.\n`;

        if (audience === 'Nh√≥m c√≥ ng∆∞·ªùi l·ªõn tu·ªïi') {
            prompt += `- L∆ØU √ù ƒê·∫∂C BI·ªÜT: V√¨ nh√≥m c√≥ ng∆∞·ªùi l·ªõn tu·ªïi, h√£y t·∫°o m·ªôt l·ªãch tr√¨nh th·∫≠t thong th·∫£, tr√°nh c√°c ho·∫°t ƒë·ªông d√†y ƒë·∫∑c, v√† c√≥ nhi·ªÅu th·ªùi gian ngh·ªâ ng∆°i h∆°n gi·ªØa c√°c ƒëi·ªÉm ƒë·∫øn.\n`;
        }
        
        if (includeFood) prompt += `- Y√™u c·∫ßu th√™m: C√≥ ƒÉn u·ªëng. G·ª£i √Ω m·ªôt qu√°n ƒÉn c·ª• th·ªÉ K√àM THEO ƒê·ªäA CH·ªà t·ª´ DANH S√ÅCH QU√ÅN ƒÇN/C√Ä PH√ä ƒë√£ cho. QUAN TR·ªåNG: Qu√°n ƒÉn ph·∫£i g·∫ßn nh·∫•t c√≥ th·ªÉ v·ªõi ng√¥i ch√πa v·ª´a ƒëi qua ho·∫∑c s·∫Øp t·ªõi.\n`;
        if (includeDrink) prompt += `- Y√™u c·∫ßu th√™m: C√≥ gh√© qu√°n n∆∞·ªõc/cafe. G·ª£i √Ω m·ªôt qu√°n c·ª• th·ªÉ K√àM THEO ƒê·ªäA CH·ªà t·ª´ DANH S√ÅCH QU√ÅN ƒÇN/C√Ä PH√ä ƒë√£ cho. QUAN TR·ªåNG: Qu√°n cafe ph·∫£i g·∫ßn nh·∫•t c√≥ th·ªÉ v·ªõi ng√¥i ch√πa v·ª´a ƒëi qua ho·∫∑c s·∫Øp t·ªõi.\n`;
        if (includeStay) prompt += `- Y√™u c·∫ßu th√™m: C√≥ ngh·ªâ l·∫°i qua ƒë√™m. G·ª£i √Ω m·ªôt nh√† ngh·ªâ/kh√°ch s·∫°n c·ª• th·ªÉ t·∫°i huy·ªán T√¢n H·ªìng K√àM THEO ƒê·ªäA CH·ªà (ch·ªâ th√™m n·∫øu khung th·ªùi gian h·ª£p l√Ω).\n`;
        
        prompt += `\nNHI·ªÜM V·ª§ C·ªêT L√ïI: D·ª±a v√†o c√°c ch√πa ng∆∞·ªùi d√πng ƒë√£ ch·ªçn v√† v·ªã tr√≠ c·ªßa ch√∫ng, h√£y s·∫Øp x·∫øp th·ª© t·ª± c√°c ƒëi·ªÉm ƒë·∫øn ƒë·ªÉ t·∫°o ra m·ªôt L·ªò TR√åNH DI CHUY·ªÇN T·ªêI ∆ØU NH·∫§T, ti·∫øt ki·ªám th·ªùi gian nh·∫•t, b·∫Øt ƒë·∫ßu t·ª´ Trung t√¢m TT. Sa R√†i.\n`;

        prompt += `\nQUY T·∫ÆC ƒê·ªäNH D·∫†NG (C·ª∞C K·ª≤ QUAN TR·ªåNG):\n`;
        prompt += `- H·ªó tr·ª£ ƒë·ªãnh d·∫°ng: *vƒÉn b·∫£n in nghi√™ng* v√† _vƒÉn b·∫£n g·∫°ch ch√¢n_.\n`;
        prompt += `- ƒê·ªãnh d·∫°ng m·ªói m·ª•c tr√™n m·ªôt d√≤ng: **Gi·ªù** Emoji - M√¥ t·∫£ ho·∫°t ƒë·ªông t·∫°i [[T√™n ƒë·ªãa ƒëi·ªÉm - ƒê·ªãa ch·ªâ]].\n`;
        prompt += `- V√≠ d·ª• M·∫™U:\n`;
        prompt += `  **07:00** üöó - Kh·ªüi h√†nh t·ª´ _Trung t√¢m Sa R√†i_.\n`;
        prompt += `  **08:00** üôè - Vi·∫øng ch√πa t·∫°i [[Ch√πa Ph∆∞·ªõc Thi·ªán - C√¥ng T·∫°o, B√¨nh Ph√∫, T√¢n H·ªìng, ƒê·ªìng Th√°p]].\n`;
        prompt += `  **12:00** üçö - D√πng b·ªØa tr∆∞a. *G·ª£i √Ω: th·ª≠ m√≥n ƒë·∫∑c s·∫£n ƒë·ªãa ph∆∞∆°ng* t·∫°i [[Qu√°n C∆°m A - 123 ƒë∆∞·ªùng Nguy·ªÖn Hu·ªá, TT. Sa R√†i, T√¢n H·ªìng, ƒê·ªìng Th√°p]].\n`;
        prompt += `  **17:00** ‚úÖ - K·∫øt th√∫c chuy·∫øn ƒëi.\n`;
        prompt += `- V·ªõi c√°c ch√πa, PH·∫¢I d√πng ƒë√∫ng t√™n v√† ƒë·ªãa ch·ªâ trong ph·∫ßn D·ªÆ LI·ªÜU B·∫ÆT BU·ªòC S·ª¨ D·ª§NG.\n`;
        prompt += `- N·∫øu ho·∫°t ƒë·ªông kh√¥ng c√≥ ƒë·ªãa ƒëi·ªÉm c·ª• th·ªÉ (v√≠ d·ª•: 'Kh·ªüi h√†nh' ho·∫∑c 'K·∫øt th√∫c chuy·∫øn ƒëi'), th√¨ kh√¥ng c·∫ßn th√™m ph·∫ßn 't·∫°i [[...]]'.`;


        const apiKey = "AIzaSyAPinf6FjtKqn4WNfJ892W3kuiq4yIBgAQ";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = { contents: [{ parts: [{ text: prompt }] }] };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`API error! status: ${response.status}`);
            const result = await response.json();
            const itineraryText = result.candidates[0].content.parts[0].text;
            parseAndRenderItinerary(itineraryText);
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            resultDiv.innerHTML = `<p class="text-center text-red-500">ƒê√£ c√≥ l·ªói x·∫£y ra khi t·∫°o l·ªãch tr√¨nh. Vui l√≤ng th·ª≠ l·∫°i sau.</p>`;
        } finally {
            loadingDiv.classList.add('hidden');
        }
    }
    
    function populateTimeOptions() {
        const startTimeSelect = document.getElementById('start-time');
        const endTimeSelect = document.getElementById('end-time');
        for (let i = 5; i <= 22; i++) {
            const hour = i.toString().padStart(2, '0');
            const optionStart = document.createElement('option');
            optionStart.value = i;
            optionStart.textContent = `${hour}:00`;
            startTimeSelect.appendChild(optionStart);

            const optionEnd = document.createElement('option');
            optionEnd.value = i;
            optionEnd.textContent = `${hour}:00`;
            endTimeSelect.appendChild(optionEnd);
        }
        // Set default values
        startTimeSelect.value = '7';
        endTimeSelect.value = '17';
    }

    // Initial setup
    document.addEventListener('DOMContentLoaded', () => {
        populateTimeOptions();
        lucide.createIcons();
    });
</script>

</body>
</html>


